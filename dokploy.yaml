# Dokploy configuration file
name: curriculum-backend

app:
  type: container
  image: ${REGISTRY_URL}/${IMAGE_NAME}:${IMAGE_TAG}

env:
  - SECRET_KEY
  - DEBUG
  - URL_SERVER
  - ALLOWED_HOSTS
  - DATABASE_URL
  - DB_ENGINE
  - DB_NAME
  - DB_USER
  - DB_PASSWORD
  - DB_HOST
  - DB_PORT
  - RECAPTCHA_PUBLIC_KEY
  - RECAPTCHA_PRIVATE_KEY
  - EMAIL_HOST
  - EMAIL_PORT
  - EMAIL_HOST_USER
  - EMAIL_HOST_PASSWORD

resources:
  cpu: 1
  memory: 1Gi

networking:
  port: 8000
  domains:
    - domain: backend.yampi.eu
      path: /

volumes:
  - name: media-files
    mountPath: /app/cv_backend/media
    size: 5Gi
  - name: static-files
    mountPath: /app/cv_backend/static
    size: 2Gi

hooks:
  predeploy:
    command: bash -c "echo 'â–¶ Ejecutando pipeline...' && bash /app/pipeline.sh"

health:
  path: /admin/login/
  initialDelaySeconds: 30
  periodSeconds: 60
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

scaling:
  min: 1
  max: 2
